<?xml version="1.0"?>
<robot>
  <macro name="velma_head" params="parent *origin">
    <joint name="head_base_joint" type="fixed">
      <insert_block name="origin" />
      <parent link="${parent}"/>
      <child link="head_base"/>
    </joint>
    
    <link name="head_base">
       <visual>
        <origin xyz="0 0 0.0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://velma_description/meshes/head_base.STL" />
        </geometry>
        <material name="torso_gray">
          <color rgba="0.5 0.5 0.5 1"/>
        </material>
      </visual>
    </link>
    
    <joint name="head_pan_motor_joint" type="fixed">
      <origin xyz="0 0 0.025" rpy="0 0 0" />
      <parent link="head_base"/>
      <child link="head_pan_motor"/>
    </joint>
    
    <link name="head_pan_motor">
       <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://velma_description/meshes/head_pan.STL" />
        </geometry>
        <material name="torso_gray">
          <color rgba="0.5 0.5 0.5 1"/>
        </material>
      </visual>
      <self_collision_checking>
        <origin xyz="0.0 0 0.04" rpy="0 0 0"/>
        <geometry>
          <capsule radius="0.07" length="0.08"/>
        </geometry>
      </self_collision_checking>
    </link>
    
    <!-- pan -->
    <joint name="head_pan_joint" type="revolute">
      <origin xyz="0 0 0.062" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
      <parent link="head_pan_motor"/>
      <child link="head_pan_link"/>
      
      <limit lower="-1.57" upper="1.57" effort="100" velocity="1.57"/>
    </joint>
    
    <link name="head_pan_link">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://velma_description/meshes/head_tilt.STL" />
        </geometry>
        <material name="torso_gray">
          <color rgba="0.5 0.5 0.5 1"/>
        </material>
      </visual>
    </link>
    
    <!-- tilt -->
    <joint name="head_tilt_joint" type="revolute">
      <origin xyz="0 0 0.048" rpy="1.57 0.0 0" />
      <axis xyz="0 0 1"/>
      <parent link="head_pan_link"/>
      <child link="head_tilt_link"/>
      <limit lower="-1.57" upper="1.57" effort="100" velocity="100"/>
    </joint>
    
    <link name="head_tilt_link">
      <visual>
        <origin xyz="0 0 0.04219" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://velma_description/meshes/head_top.STL" />
        </geometry>
        <material name="torso_gray">
          <color rgba="0.5 0.5 0.5 1"/>
        </material>
      </visual>
      <self_collision_checking>
        <origin xyz="0.0 0.12 0.0" rpy="-1.57075 0 0"/>
        <geometry>
          <capsule radius="0.07" length="0.24"/>
        </geometry>
      </self_collision_checking>
      <self_collision_checking>
        <origin xyz="0.05 0.18 0.0" rpy="0 0 0"/>
        <geometry>
          <capsule radius="0.07" length="0.23"/>
        </geometry>
      </self_collision_checking>
    </link>
    
    <!-- sensors -->
    
    <head_camera parent="head_tilt_link" name="stereo_left">
      <!--<origin xyz="0.074819 -0.19424 0.039144" rpy="1.572 -0.0046408 0.0147"/> -->
      <!-- <origin xyz="0.072474    -0.21002    0.043726" rpy="1.5767  -0.0094749   0.0058925"/> -->
      <origin xyz="${cal_head_to_stereo_left_x} ${cal_head_to_stereo_left_y} ${cal_head_to_stereo_left_z}"
              rpy="${cal_head_to_stereo_left_roll} ${cal_head_to_stereo_left_pitch} ${cal_head_to_stereo_left_yaw}"/>
    </head_camera>
    
    <head_camera parent="stereo_left_link" name="stereo_right">
      <origin xyz="0.0 -0.09 0.0" rpy="0 0 0"/>
    </head_camera>
    
    <head_camera parent="head_tilt_link" name="kinect_left_rgb">
      <!--<origin xyz="0.013309 -0.010124 -0.06841" rpy="1.5634 -0.022662 0.37293"/> -->
      <!--<origin xyz="0.019408   -0.010485   -0.088064" rpy="1.5637  -0.0097296     0.36447"/>-->
      <origin xyz="${cal_stereo_left_to_kinect_left_x} ${cal_stereo_left_to_kinect_left_y} ${cal_stereo_left_to_kinect_left_z}"
              rpy="${cal_stereo_left_to_kinect_left_roll} ${cal_stereo_left_to_kinect_left_pitch} ${cal_stereo_left_to_kinect_left_yaw}"/>
    </head_camera>
    
    <head_camera parent="kinect_left_rgb_link" name="kinect_left_ir">
      <origin xyz="0.0 0.03 0.0" rpy="0 0 0"/>
    </head_camera>
    
    <head_camera parent="head_tilt_link" name="kinect_right_rgb">
      <!--<origin xyz="0.00045739 -0.071104 -0.074766" rpy="1.5892 -0.035955 -0.34978"/> -->
      <!--<origin xyz="-0.034936    -0.05614   -0.084153" rpy="1.588   -0.024981    -0.37211"/>-->
      <origin xyz="${cal_stereo_left_to_kinect_right_x} ${cal_stereo_left_to_kinect_right_y} ${cal_stereo_left_to_kinect_right_z}"
              rpy="${cal_stereo_left_to_kinect_right_roll} ${cal_stereo_left_to_kinect_right_pitch} ${cal_stereo_left_to_kinect_right_yaw}"/>
    </head_camera>
    
    <head_camera parent="kinect_right_rgb_link" name="kinect_right_ir">
      <origin xyz="0.0 0.03 0.0" rpy="0 0 0"/>
    </head_camera>
  </macro>
</robot>

